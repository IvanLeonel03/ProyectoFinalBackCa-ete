<div class="container">
    <h1>üõí Mi Carrito</h1>
    
    {{#if cart.products.length}}
        <!-- Resumen del carrito -->
        <div class="cart-summary">
            <div class="summary-item">
                <strong>Productos en el carrito:</strong> {{cart.products.length}}
            </div>
            <div class="summary-item">
                <strong>Total a pagar:</strong> <span class="total-amount">{{formatPrice total}}</span>
            </div>
        </div>

        <!-- Lista de productos en el carrito -->
        <div class="cart-items">
            {{#each cart.products}}
                <div class="cart-item" data-product-id="{{this.product._id}}">
                    <div class="item-image">
                        {{#if this.product.thumbnails.length}}
                            <img src="{{this.product.thumbnails.[0]}}" alt="{{this.product.title}}"
                                 onerror="this.src='https://via.placeholder.com/100x100/95a5a6/ffffff?text=Imagen'">
                        {{else}}
                            <div class="no-image-small">üñºÔ∏è</div>
                        {{/if}}
                    </div>
                    
                    <div class="item-details">
                        <h3 class="item-title">{{this.product.title}}</h3>
                        <p class="item-description">{{this.product.description}}</p>
                        <p class="item-category">Categor√≠a: {{this.product.category}}</p>
                        <p class="item-price">{{formatPrice this.product.price}} c/u</p>
                        <p class="item-stock">Stock disponible: {{this.product.stock}}</p>
                    </div>
                    
                    <div class="item-controls">
                        <div class="quantity-controls">
                            <label for="quantity-{{this.product._id}}">Cantidad:</label>
                            <div class="quantity-input-group">
                                <button type="button" 
                                        onclick="updateQuantity('{{../cart._id}}', '{{this.product._id}}', {{dec this.quantity}})"
                                        class="quantity-btn"
                                        {{#lte this.quantity 1}}disabled{{/lte}}>
                                    -
                                </button>
                                <input type="number" 
                                       id="quantity-{{this.product._id}}" 
                                       value="{{this.quantity}}" 
                                       min="1" 
                                       max="{{this.product.stock}}"
                                       onchange="updateQuantityInput('{{../cart._id}}', '{{this.product._id}}', this.value)"
                                       style="width: 60px; text-align: center;">
                                <button type="button" 
                                        onclick="updateQuantity('{{../cart._id}}', '{{this.product._id}}', {{inc this.quantity}})"
                                        class="quantity-btn"
                                        {{#gte this.quantity this.product.stock}}disabled{{/gte}}>
                                    +
                                </button>
                            </div>
                        </div>
                        
                        <div class="item-subtotal">
                            <strong>Subtotal: {{formatPrice (multiply this.product.price this.quantity)}}</strong>
                        </div>
                        
                        <button onclick="removeFromCart('{{../cart._id}}', '{{this.product._id}}')" 
                                class="btn btn-danger">
                            üóëÔ∏è Eliminar
                        </button>
                    </div>
                </div>
            {{/each}}
        </div>

        <!-- Acciones del carrito -->
        <div class="cart-actions">
            <div class="action-buttons">
                <button onclick="clearCart('{{cart._id}}')" class="btn btn-danger">
                    üóëÔ∏è Vaciar Carrito
                </button>
                <a href="/products" class="btn btn-outline">
                    üè™ Seguir Comprando
                </a>
                <button onclick="checkout('{{cart._id}}')" class="btn btn-success btn-large">
                    üí≥ Proceder al Pago - {{formatPrice total}}
                </button>
            </div>
            
            <div class="cart-total">
                <h2>Total del Carrito: {{formatPrice total}}</h2>
            </div>
        </div>
    {{else}}
        <!-- Carrito vac√≠o -->
        <div class="empty-cart">
            <div class="empty-cart-icon">üõí</div>
            <h2>Tu carrito est√° vac√≠o</h2>
            <p>¬°A√∫n no has agregado productos a tu carrito!</p>
            <p>Descubre nuestros productos y encuentra algo especial.</p>
            <a href="/products" class="btn btn-primary btn-large">
                üè™ Ir a la Tienda
            </a>
        </div>
    {{/if}}
</div>

<script src="/js/cart.js"></script>

<script>
// Verificar que el carrito se carg√≥ correctamente
document.addEventListener('DOMContentLoaded', function() {
    console.log('üõí P√°gina del carrito cargada');
    console.log('üì¶ Productos en el carrito:', {{cart.products.length}});
    
    // Actualizar contador en el navbar
    if (typeof updateCartCounter === 'function') {
        updateCartCounter();
    }
});
</script>