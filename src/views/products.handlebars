<div class="container">
    <h1>üì¶ Nuestros Productos</h1>
    
    <!-- Filtros y B√∫squeda -->
    <div class="filters">
        <form action="/products" method="GET" class="filter-form">
            <div class="filter-group">
                <label for="query">üîç Buscar:</label>
                <input type="text" id="query" name="query" placeholder="Nombre o descripci√≥n..." value="{{currentQuery}}">
            </div>
            
            <div class="filter-group">
                <label for="category">üìÇ Categor√≠a:</label>
                <select id="category" name="category">
                    <option value="">Todas las categor√≠as</option>
                    <option value="electronics" {{#eq currentCategory 'electronics'}}selected{{/eq}}>Electr√≥nicos</option>
                    <option value="clothing" {{#eq currentCategory 'clothing'}}selected{{/eq}}>Ropa</option>
                    <option value="home" {{#eq currentCategory 'home'}}selected{{/eq}}>Hogar</option>
                    <option value="sports" {{#eq currentCategory 'sports'}}selected{{/eq}}>Deportes</option>
                    <option value="books" {{#eq currentCategory 'books'}}selected{{/eq}}>Libros</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="sort">üí∞ Ordenar por precio:</label>
                <select id="sort" name="sort">
                    <option value="">Sin ordenar</option>
                    <option value="asc" {{#eq currentSort 'asc'}}selected{{/eq}}>Menor a Mayor</option>
                    <option value="desc" {{#eq currentSort 'desc'}}selected{{/eq}}>Mayor a Menor</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="limit">üìÑ Productos por p√°gina:</label>
                <select id="limit" name="limit">
                    <option value="5" {{#eq limit 5}}selected{{/eq}}>5</option>
                    <option value="10" {{#eq limit 10}}selected{{/eq}}>10</option>
                    <option value="20" {{#eq limit 20}}selected{{/eq}}>20</option>
                </select>
            </div>
            
            <button type="submit" class="btn btn-primary">Filtrar</button>
            <a href="/products" class="btn btn-secondary">Limpiar filtros</a>
        </form>
    </div>

    <!-- Informaci√≥n de resultados -->
    <div class="results-info">
        <p>Mostrando <strong>{{payload.length}}</strong> de <strong>{{totalProducts}}</strong> productos encontrados</p>
    </div>

    <!-- Lista de productos -->
    {{#if payload.length}}
        <div class="products-grid">
            {{#each payload}}
                <div class="product-card">
                    <div class="product-image">
                        {{#if thumbnails.length}}
                            <img src="{{thumbnails.[0]}}" alt="{{title}}" 
                                 onerror="this.src='https://via.placeholder.com/400x300/95a5a6/ffffff?text=Imagen+No+Disponible'">
                        {{else}}
                            <div class="no-image">üñºÔ∏è Sin imagen</div>
                        {{/if}}
                    </div>
                    
                    <div class="product-info">
                        <h3 class="product-title">{{title}}</h3>
                        <p class="product-description">{{description}}</p>
                        
                        <div class="product-details">
                            <span class="product-price">{{formatPrice price}}</span>
                            <span class="product-category">{{category}}</span>
                            <span class="product-stock {{#lt stock 5}}low-stock{{/lt}} {{#eq stock 0}}out-of-stock{{/eq}}">
                                {{#eq stock 0}}
                                    ‚ùå Agotado
                                {{else}}
                                    Stock: {{stock}}
                                {{/eq}}
                            </span>
                        </div>
                        
                        <div class="product-actions">
                            <a href="/products/{{_id}}" class="btn btn-outline">üëÄ Ver detalles</a>
                            <button onclick="addToCart('{{_id}}')" 
                                    class="btn btn-success" 
                                    {{#eq stock 0}}disabled{{/eq}}>
                                üõí Agregar al carrito
                            </button>
                        </div>
                    </div>
                </div>
            {{/each}}
        </div>

        <!-- Paginaci√≥n -->
        <div class="pagination">
            {{#if hasPrevPage}}
                <a href="{{prevLink}}" class="pagination-btn">
                    ‚¨ÖÔ∏è Anterior
                </a>
            {{else}}
                <span class="pagination-btn disabled">‚¨ÖÔ∏è Anterior</span>
            {{/if}}
            
            <span class="pagination-info">
                P√°gina <strong>{{page}}</strong> de <strong>{{totalPages}}</strong>
            </span>
            
            {{#if hasNextPage}}
                <a href="{{nextLink}}" class="pagination-btn">
                    Siguiente ‚û°Ô∏è
                </a>
            {{else}}
                <span class="pagination-btn disabled">Siguiente ‚û°Ô∏è</span>
            {{/if}}
        </div>
    {{else}}
        <div class="no-products">
            <h2>üòî No se encontraron productos</h2>
            <p>Intenta con otros filtros de b√∫squeda</p>
            <a href="/products" class="btn btn-primary">Ver todos los productos</a>
        </div>
    {{/if}}
    

<script src="/js/cart.js"></script>

<script>
// Script adicional para asegurar que las funciones est√©n disponibles
document.addEventListener('DOMContentLoaded', function() {
    console.log('‚úÖ P√°gina de productos cargada');
    
    // Verificar que las funciones est√©n disponibles
    if (typeof addToCart === 'function') {
        console.log('‚úÖ Funci√≥n addToCart disponible');
    } else {
        console.error('‚ùå Funci√≥n addToCart NO disponible');
    }
});
</script>
</div>